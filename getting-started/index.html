<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.jruyi.org/getting-started/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Getting Started - JRuyi</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-46193512-1', 'jruyi.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">JRuyi</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Getting Started</a>
                    </li>
                
                
                
                    <li >
                        <a href="../user-guide/">User Guide</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../user-guide/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/jruyi/jruyi.git">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#getting-started">Getting Started</a></li>
        
            <li><a href="#building-a-discard-server">Building a Discard Server</a></li>
        
            <li><a href="#building-an-echo-server">Building an Echo Server</a></li>
        
            <li><a href="#building-a-daytime-server">Building a Daytime Server</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link"></a></h1>
<p>Some examples to let you get started quickly with JRuyi.</p>
<p>To get the source code of examples, please check <a href="https://github.com/jruyi/jruyi-examples">jruyi-examples</a> on Github.
In the later sections, <strong>$JRUYI_EXAMPLES_HOME</strong> will be used to refer to the root directory of your local copy of the repo
<code>jruyi-examples</code>.  All the example projects are available in Gradle as well as Maven.</p>
<div class="admonition note">
<p class="admonition-title">Note:</p>
<p>All the examples are given under a UNIX-like environment. It should be very straightforward for you to make them
work on Windows. Just use the counterpart BAT file for a shell script file mentioned in the examples. For example,
use ruyi.bat for ruyi and ruyi-cli.bat for ruyi-cli.</p>
</div>
<p>We also assume that you know how to download JRuyi.  If you don't, please go check <a href="../#download">Download</a>. And we will
use <strong>$JRUYI_HOME</strong> to refer to the directory where the downloaded jruyi package is unpacked.</p>
<h2 id="building-a-discard-server">Building a Discard Server<a class="headerlink" href="#building-a-discard-server" title="Permanent link"></a></h2>
<p>Lets start with writing a <a href="http://tools.ietf.org/html/rfc863" title="Discard Protocol">discard</a> server which simply throws away any received data.</p>
<p>To implement a discard server, simply create an <a href="http://javadoc.jruyi.org/jruyi-api/v2.3.1/org/jruyi/core/INioService.html">INioService</a>
of type TcpServer, and start it as the following code shows.</p>
<pre><code class="java">package org.jruyi.example.discard;

import org.jruyi.core.INioService;
import org.jruyi.core.ITcpServerConfiguration;
import org.jruyi.core.RuyiCore;
import org.jruyi.io.IBuffer;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class DiscardServer {

    private static final Logger c_logger = LoggerFactory.getLogger(DiscardServer.class);

    public static void main(String[] args) {
        try {
            // Build an Nio Service of type TcpServer
            final INioService&lt;IBuffer, Object, ? extends ITcpServerConfiguration&gt; tcpServer = RuyiCore
                    .newTcpServerBuilder()
                    .port(10009)
                    .serviceId(&quot;jruyi.example.discard&quot;)
                    .build();

            // Start tcpServer
            tcpServer.start();
        } catch (Throwable t) {
            c_logger.error(&quot;Failed to start discard server&quot;, t);
        }
    }
}
</code></pre>

<p>Simple? Yeah, it is.  But there's a problem of this code that it cannot serve as a good demo.  Because there's no prove
that we actually got the data sent from a client.  So lets write a session listener and log the received data.</p>
<pre><code class="java">package org.jruyi.example.discard;

import org.jruyi.common.StrUtil;
import org.jruyi.io.IBuffer;
import org.jruyi.io.ISession;
import org.jruyi.io.SessionListener;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

class DiscardServerListener extends SessionListener&lt;IBuffer, Object&gt; {

    private static final Logger c_logger = LoggerFactory.getLogger(DiscardServerListener.class);

    @Override
    public void onMessageReceived(ISession session, IBuffer inMsg) {
        c_logger.info(StrUtil.join(&quot;Got data &gt;&gt;&quot;, StrUtil.getLineSeparator(), inMsg));
    }
}
</code></pre>

<p>Method <code>DiscardServerListener.onMessageReceived</code> will be invoked when any data arrives. And it dumps the received data.</p>
<p>Next, lets hook this DiscardServerListener to the NioService before starting.</p>
<pre><code class="java">...
// Set sessionListener
tcpServer.sessionListener(new DiscardServerListener());

// Start tcpServer
tcpServer.start();
...
</code></pre>

<p>Now, you should/can see what data the server gets.  However, this code is still not good enough.  You may have already
noticed that there's a <code>tcpServer.start()</code> but no call of stop, which means the NioService does not stop gracefully when this
application terminates.  What should we do then?  I'm not going to discuss the solution here since it does not really
relate to JRuyi.  You can find the solution in the source code
<a href="https://github.com/jruyi/jruyi-examples/blob/master/discard/src/main/java/org/jruyi/example/discard/DiscardServer.java">DiscardServer.java</a>.</p>
<p>If you have git-cloned the <a href="https://github.com/jruyi/jruyi-examples">jruyi-examples</a> from Github, please go to the directory
<strong>$JRUYI_EXAMPLES_HOME</strong>/discard.  Then build the project by running the following command.</p>
<pre><code class="bash">$ ./gradlew clean build
</code></pre>

<p>If building successfully, you should get the jar locating at <strong>$JRUYI_EXAMPLES_HOME</strong>/discard/build/libs, and you can start
the discard server as follows.</p>
<pre><code class="bash">$ java -jar build/libs/discard-1.0.0-SNAPSHOT.jar
</code></pre>

<div class="admonition note">
<p class="admonition-title">For Maven Users:</p>
<p>Please use the following command to build the project.</p>
<p><code>$ mvn clean package</code></p>
<p>And use the following command to run the server.</p>
<p><code>$ java -jar target/discard-1.0.0-SNAPSHOT.jar</code></p>
</div>
<p>You should see logs printed on console similar as follows.</p>
<pre><code class="xml">[main] INFO org.jruyi.common.internal.Scheduler - Scheduler activated: numberOfThreads=1
[main] INFO org.jruyi.io.channel.ChannelAdmin - Activating ChannelAdmin...
[jruyi-selector-0] INFO org.jruyi.io.channel.SelectorThread - jruyi-selector-0 started
[main] INFO org.jruyi.io.channel.ChannelAdmin - ChannelAdmin activated
[jruyi-selector-1] INFO org.jruyi.io.channel.SelectorThread - jruyi-selector-1 started
[main] INFO org.jruyi.io.buffer.BufferFactory - BufferFactory: unitCapacity=8192
[main] INFO org.jruyi.io.tcpserver.TcpAcceptor - Starting TcpAcceptor...
[main] INFO org.jruyi.io.tcpserver.TcpAcceptor - TcpAcceptor started
[main] INFO org.jruyi.io.tcpserver.TcpServer - Starting TcpServer[jruyi.example.discard]...
[main] INFO org.jruyi.io.tcpserver.TcpServer - TcpServer[jruyi.example.discard] started, listening on /0:0:0:0:0:0:0:0:10009
</code></pre>

<p>OK, we just got the discard server started. It's time to use telnet to make a test.</p>
<pre><code class="xml">$ telnet localhost 10009
</code></pre>

<p>Then just type something and you won't get any response.
But you should see what you typed be dumped on the console in which the discard server started.</p>
<p>Congratulations! You just learned how to use the lib <code>jruyi-core</code> to build a discard server.  But it would be much easier
if you use <code>jruyi</code> runtime.  Let me show you how easy it is.</p>
<h4 id="1-start-jruyi">1. Start JRuyi<a class="headerlink" href="#1-start-jruyi" title="Permanent link"></a></h4>
<p>Please go to <strong>$JRUYI_HOME</strong> and start JRuyi as follows.</p>
<pre><code class="bash">$ bin/ruyi
</code></pre>

<h4 id="2-create-a-session-service-endpoint">2. Create a Session Service Endpoint<a class="headerlink" href="#2-create-a-session-service-endpoint" title="Permanent link"></a></h4>
<p>Open a new console and run the following command under <strong>$JRUYI_HOME</strong> to create a TCP server (Session Service) listening on port 10009.</p>
<pre><code class="xml">$ bin/ruyi-cli conf:create jruyi.io.tcpserver jruyi.me.endpoint.id=jruyi.example.discard port=10009
</code></pre>

<p>The created TCP Server Endpoint is identified with <code>jruyi.example.discard</code>.</p>
<p>As you see, a Session Service Endpoint of TcpServer is created by creating a configuration of <code>jruyi.io.tcpserver</code>.</p>
<h4 id="3-configure-the-routing-table">3. Configure the Routing Table<a class="headerlink" href="#3-configure-the-routing-table" title="Permanent link"></a></h4>
<p>Run the following command under <strong>$JRUYI_HOME</strong> to set a route.</p>
<pre><code class="xml">$ bin/ruyi-cli route:set jruyi.example.discard jruyi.me.endpoint.null
</code></pre>

<p>This is to tell Messaging Engine to dispatch any messages from endpoint <code>jruyi.example.discard</code> to endpoint <code>jruyi.me.endpoint.null</code> which is a builtin endpoint to swallow any messages dispatched to it.</p>
<p>That's it! You just built a discard server using JRuyi and you can use telnet to make tests.</p>
<p>To see the data that the discard server received, you can add the builtin MsgLog Filter to the filter chain of the TcpServer <code>jruyi.example.discard</code> by running the following command under <strong>$JRUYI_HOME</strong>.</p>
<pre><code class="xml">$ bin/ruyi-cli conf:update '&quot;(jruyi.me.endpoint.id=jruyi.example.discard)&quot;' filters=jruyi.io.msglog.filter
</code></pre>

<p>Now use telnet to test again.  You should see what you typed be dumped on the console in which JRuyi was started.</p>
<h4 id="4-shutdown-jruyi">4. Shutdown JRuyi<a class="headerlink" href="#4-shutdown-jruyi" title="Permanent link"></a></h4>
<p>To shutdown JRuyi, simply press ctrl-c in the console in which JRuyi was started. Alternatively, you can run the following command under <strong>$JRUYI_HOME</strong>.</p>
<pre><code class="bash">$ bin/ruyi-cli shutdown
</code></pre>

<h2 id="building-an-echo-server">Building an Echo Server<a class="headerlink" href="#building-an-echo-server" title="Permanent link"></a></h2>
<p>In <a href="#building-a-discard-server">Building a Discard Server</a>, you should have got the idea of how to receive data from
client in JRuyi. But you might not be clear on how to send back some data to client. So next, let's show you the how-to
by building an <a href="http://tools.ietf.org/html/rfc862" title="Echo Protocol">echo</a> server.</p>
<p>The key difference to implement an echo server is that the SessionListener need hold a reference to the <code>INioService</code>.
And use it to send back whatever is received in method <code>onMessageReceived</code>.</p>
<pre><code class="java">package org.jruyi.example.echo;

import org.jruyi.core.INioService;
import org.jruyi.core.ITcpServerConfiguration;
import org.jruyi.io.IBuffer;
import org.jruyi.io.ISession;
import org.jruyi.io.SessionListener;

class EchoServerListener extends SessionListener&lt;IBuffer, IBuffer&gt; {

    // Hold a reference to INioService
    private final INioService&lt;IBuffer, IBuffer, ? extends ITcpServerConfiguration&gt; m_tcpServer;

    EchoServerListener(INioService&lt;IBuffer, IBuffer, ? extends ITcpServerConfiguration&gt; tcpServer) {
        m_tcpServer = tcpServer;
    }

    @Override
    public void onMessageReceived(ISession session, IBuffer inMsg) {
        // Send back whatever is received.
        m_tcpServer.write(session, inMsg);
    }
}
</code></pre>

<p>Class <code>EchoServer</code> is almost the same as class <code>DiscardServer</code> except that the instance of <code>INioService</code> need be used to
construct an instance of <code>EchoServerListener</code>. Below is the code for <code>EchoServer</code>.</p>
<pre><code class="java">package org.jruyi.example.echo;

import org.jruyi.core.INioService;
import org.jruyi.core.ITcpServerConfiguration;
import org.jruyi.core.RuyiCore;
import org.jruyi.io.IBuffer;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class EchoServer {

    private static final Logger c_logger = LoggerFactory.getLogger(EchoServer.class);

    static class ShutdownHook extends Thread {

        private final INioService&lt;IBuffer, IBuffer, ? extends ITcpServerConfiguration&gt; m_tcpServer;

        ShutdownHook(INioService&lt;IBuffer, IBuffer, ? extends ITcpServerConfiguration&gt; tcpServer) {
            m_tcpServer = tcpServer;
        }

        @Override
        public void run() {
            m_tcpServer.stop();
        }
    }

    public static void main(String[] args) {
        try {
            // Build an Nio Service of type TcpServer
            final INioService&lt;IBuffer, IBuffer, ? extends ITcpServerConfiguration&gt; tcpServer = RuyiCore
                    .newTcpServerBuilder()
                    .port(10007)
                    .serviceId(&quot;jruyi.example.echo&quot;)
                    .build();

            // Set sessionListener
            tcpServer.sessionListener(new EchoServerListener(tcpServer));

            // Start tcpServer
            tcpServer.start();

            // To shutdown gracefully
            Runtime.getRuntime().addShutdownHook(new ShutdownHook(tcpServer));
        } catch (Throwable t) {
            c_logger.error(&quot;Failed to start echo service&quot;, t);
        }
    }
}
</code></pre>

<p>You can also use JRuyi runtime to build an echo server.</p>
<p>After starting JRuyi, please execute the following commands under <strong>$JRUYI_HOME</strong>.</p>
<pre><code class="xml"># Create a TCP server listening on port 10007
$ bin/ruyi-cli conf:create jruyi.io.tcpserver jruyi.me.endpoint.id=jruyi.example.echo port=10007

# Route any message from endpoint jruyi.example.echo back to itself
$ bin/ruyi-cli route:set jruyi.example.echo jruyi.example.echo
</code></pre>

<p>Now, you should be able to test echo server by running the following command.</p>
<pre><code class="xml">$ telnet localhost 10007
</code></pre>

<p>This time you will see that whatever you typed will be echoed.</p>
<h2 id="building-a-daytime-server">Building a Daytime Server<a class="headerlink" href="#building-a-daytime-server" title="Permanent link"></a></h2></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2015 <a href="https://twitter.com/jruyi_org">JRuyi.org</a></p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
